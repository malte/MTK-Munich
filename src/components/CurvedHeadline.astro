---
import { generateUniqueId } from "../utils.js";

const uniqueId = generateUniqueId();
const curveId = generateUniqueId();

const {
  tag = "h2",
  type,
  offset = 0,
  class: className,
  ...props
} = Astro.props;
const allowedTags = ["h1", "h2", "h3", "h4", "h5", "h6"];
const headlineTag = allowedTags.includes(tag) ? tag : "h2";
const curves = [
  "M 50,50 a 1200,1200 0 0,1 950,400",
  "M 50,300 a 700,700 0 0,1 950,0",
  "M 100,500 a 150,150 0 1,1 300,0",
  "M 50,50 a 700,700 0 0,0 950,0",
];
const curve = curves[type];
---

<div
  id={uniqueId}
  class:list={[
    "curved-headline font-extrabold pointer-events-none fill-terracotta",
    className,
  ]}
>
  <Fragment set:html={`<${headlineTag}>`} />
  <svg viewBox="0 0 1000 500">
    <rect
      width="1000"
      height="500"
      x="0"
      y="0"
      style="fill:transparent;stroke:black;stroke-width:0;"></rect>
    <path
      id={curveId}
      fill="transparent"
      stroke="#0000c8"
      stroke-width="0"
      d={curve}></path>
    <text width="500" class="">
      <textPath href=`#${curveId}` class="animated-text" startOffset="0">
        <slot />
      </textPath>
    </text>
  </svg>
  <Fragment set:html={`</${headlineTag}>`} />
  <script define:vars={{ uniqueId, offset }} is:inline>
    const div = document.getElementById(uniqueId);
    const textPath = div.querySelector("textPath");

    window.addEventListener(
      "scroll",
      () => {
        const scrollPos =
          (10 * document.documentElement.scrollTop) /
          (document.body.offsetHeight - window.innerHeight);
        //console.log(scrollPos);
        const startOffset =
          10 * (Math.sin((eval(offset) + scrollPos) * 2) + 0.5);
        //console.log(startOffset);
        textPath.setAttribute("startOffset", `${startOffset}%`);
      },
      false
    );
  </script>
</div>
<div class="h-[200px] sm:h-[400px] block"></div>

<style></style>
