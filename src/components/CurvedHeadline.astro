---
import { generateUniqueId } from "../utils.js";

const uniqueId = generateUniqueId();
const {
  tag = "h2",
  type,
  offset = 0,
  class: className,
  ...props
} = Astro.props;
const allowedTags = ["h1", "h2", "h3", "h4", "h5", "h6"];
const headlineTag = allowedTags.includes(tag) ? tag : "h2";
---

<div
  id={uniqueId}
  class:list={[className, "font-extrabold text-2xl pointer-events-none	"]}
>
  <Fragment set:html={`<${headlineTag}>`}>
    <svg viewBox="0 0 1000 1000">
      <path
        id="curve"
        fill="transparent"
        stroke="#0000c8"
        stroke-width="0"
        d="
        M 500,500
        m -400,400
        a 500,500
        0
        0,1
        800,-400"
      ></path>
      <text width="500" class="text-blue-600">
        <textPath href="#curve" class="animated-text" startOffset="0">
          <slot />
        </textPath>
      </text>
    </svg>
  </Fragment>
  <script define:vars={{ uniqueId, offset }} is:inline>
    const div = document.getElementById(uniqueId);
    const textPath = div.querySelector("textPath");

    window.addEventListener(
      "scroll",
      () => {
        const startOffset =
          100 *
          Math.sin(
            offset +
              (document.documentElement.scrollTop /
                (document.body.offsetHeight - window.innerHeight)) *
                5
          );
        //console.log(startOffset);
        textPath.setAttribute("startOffset", `${startOffset}%`);
      },
      false
    );
  </script>
</div>
